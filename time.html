<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time for All - Productivity Timer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            min-height: 100vh;
            transition: var(--transition);
        }

        body.dark-mode {
            background-color: var(--dark-color);
            color: var(--light-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.2rem;
            color: var(--primary-color);
        }

        .mode-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
            transition: var(--transition);
        }

        body.dark-mode .mode-toggle {
            color: var(--light-color);
        }

        .current-time {
            text-align: center;
            margin-bottom: 30px;
        }

        .location-time {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .time-display {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .date-display {
            font-size: 1.5rem;
            opacity: 0.8;
        }

        .manual-timezone {
            display: none;
            margin-top: 15px;
        }

        .manual-timezone.show {
            display: block;
        }

        .manual-timezone input {
            padding: 8px;
            border-radius: var(--border-radius);
            border: 1px solid #ccc;
            margin-right: 10px;
        }

        .manual-timezone button {
            padding: 8px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .manual-timezone button:hover {
            background-color: var(--secondary-color);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .tab {
            padding: 10px 20px;
            background-color: transparent;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            color: var(--dark-color);
        }

        body.dark-mode .tab {
            color: var(--light-color);
        }

        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .timer-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }

        body.dark-mode .timer-container {
            background-color: #2b2d42;
        }

        .timer-display {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #d91a6d;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #3ab7d8;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid #ccc;
            font-size: 1rem;
        }

        body.dark-mode .input-group input {
            background-color: #343a40;
            border-color: #495057;
            color: var(--light-color);
        }

        .laps {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .lap-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        body.dark-mode .lap-item {
            border-bottom: 1px solid #495057;
        }

        .world-clock {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .clock-city {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        body.dark-mode .clock-city {
            background-color: #2b2d42;
        }

        .clock-city-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .clock-city-time {
            font-size: 1.2rem;
        }

        .pomodoro-cycles {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .cycle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #e9ecef;
        }

        body.dark-mode .cycle {
            background-color: #495057;
        }

        .cycle.completed {
            background-color: var(--success-color);
        }

        .reminder-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .reminder-form input {
            flex: 1;
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid #ccc;
        }

        body.dark-mode .reminder-form input {
            background-color: #343a40;
            border-color: #495057;
            color: var(--light-color);
        }

        .reminder-list {
            margin-top: 20px;
        }

        .reminder-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        body.dark-mode .reminder-item {
            border-bottom: 1px solid #495057;
        }

        .reminder-item button {
            background: none;
            border: none;
            color: var(--warning-color);
            cursor: pointer;
        }

        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            z-index: 100;
        }

        .fullscreen-btn:hover {
            background-color: var(--secondary-color);
        }

        .fullscreen-clock {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--light-color);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        body.dark-mode .fullscreen-clock {
            background-color: var(--dark-color);
        }

        .fullscreen-clock.active {
            display: flex;
        }

        .fullscreen-time {
            font-size: 10rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .fullscreen-date {
            font-size: 2rem;
            opacity: 0.8;
        }

        .close-fullscreen {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        body.dark-mode .close-fullscreen {
            color: var(--light-color);
        }

        @media (max-width: 768px) {
            .timer-display {
                font-size: 3rem;
            }
            
            .fullscreen-time {
                font-size: 5rem;
            }
            
            .controls {
                flex-wrap: wrap;
            }
            
            .btn {
                flex: 1 0 40%;
                margin-bottom: 10px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .time-display {
                font-size: 2rem;
            }
            
            .date-display {
                font-size: 1.2rem;
            }
            
            .timer-display {
                font-size: 2.5rem;
            }
            
            .fullscreen-time {
                font-size: 3rem;
            }
            
            .btn {
                flex: 1 0 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Time for All</h1>
            <button class="mode-toggle" id="modeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>

        <div class="current-time">
            <div class="location-time" id="locationTime">Detecting your location...</div>
            <div class="time-display" id="timeDisplay">--:--:-- --</div>
            <div class="date-display" id="dateDisplay">Day, Month DD, YYYY</div>
            
            <div class="manual-timezone" id="manualTimezone">
                <p>Internet connection not available. Please set your timezone manually:</p>
                <input type="text" id="timezoneInput" placeholder="e.g., GMT+6">
                <button id="setTimezoneBtn">Set Timezone</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="stopwatch">Stopwatch</button>
            <button class="tab" data-tab="countdown">Countdown</button>
            <button class="tab" data-tab="pomodoro">Pomodoro</button>
            <button class="tab" data-tab="worldclock">World Clock</button>
            <button class="tab" data-tab="reminders">Reminders</button>
        </div>

        <!-- Stopwatch Tab -->
        <div class="tab-content active" id="stopwatch">
            <div class="timer-container">
                <h2>Stopwatch</h2>
                <div class="timer-display" id="stopwatchDisplay">00:00:00.000</div>
                <div class="controls">
                    <button class="btn btn-primary" id="startStopwatch">
                        <i class="fas fa-play"></i> Start
                    </button>
                    <button class="btn btn-secondary" id="stopStopwatch" disabled>
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button class="btn btn-warning" id="resetStopwatch" disabled>
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button class="btn btn-success" id="lapStopwatch" disabled>
                        <i class="fas fa-flag"></i> Lap
                    </button>
                </div>
                <div class="laps" id="stopwatchLaps"></div>
            </div>
        </div>

        <!-- Countdown Tab -->
        <div class="tab-content" id="countdown">
            <div class="timer-container">
                <h2>Countdown Timer</h2>
                <div class="timer-display" id="countdownDisplay">00:00:00</div>
                <div class="input-group">
                    <label for="countdownInput">Set Countdown (HH:MM:SS)</label>
                    <input type="text" id="countdownInput" placeholder="00:30:00">
                </div>
                <div class="controls">
                    <button class="btn btn-primary" id="startCountdown">
                        <i class="fas fa-play"></i> Start
                    </button>
                    <button class="btn btn-secondary" id="pauseCountdown" disabled>
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button class="btn btn-warning" id="resetCountdown" disabled>
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- Pomodoro Tab -->
        <div class="tab-content" id="pomodoro">
            <div class="timer-container">
                <h2>Pomodoro Timer</h2>
                <div class="timer-display" id="pomodoroDisplay">25:00</div>
                <div class="pomodoro-cycles" id="pomodoroCycles"></div>
                <div class="controls">
                    <button class="btn btn-primary" id="startPomodoro">
                        <i class="fas fa-play"></i> Start Work
                    </button>
                    <button class="btn btn-secondary" id="pausePomodoro" disabled>
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button class="btn btn-warning" id="skipPomodoro" disabled>
                        <i class="fas fa-forward"></i> Skip
                    </button>
                </div>
            </div>
        </div>

        <!-- World Clock Tab -->
        <div class="tab-content" id="worldclock">
            <div class="timer-container">
                <h2>World Clock</h2>
                <div class="world-clock" id="worldClockContainer">
                    <!-- Cities will be added here dynamically -->
                </div>
            </div>
        </div>

        <!-- Reminders Tab -->
        <div class="tab-content" id="reminders">
            <div class="timer-container">
                <h2>Event Reminders</h2>
                <div class="reminder-form">
                    <input type="text" id="reminderInput" placeholder="Enter reminder text">
                    <input type="time" id="reminderTime">
                    <button class="btn btn-primary" id="addReminder">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
                <div class="reminder-list" id="reminderList">
                    <!-- Reminders will be added here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <button class="fullscreen-btn" id="fullscreenBtn">
        <i class="fas fa-expand"></i>
    </button>

    <div class="fullscreen-clock" id="fullscreenClock">
        <button class="close-fullscreen" id="closeFullscreen">
            <i class="fas fa-times"></i>
        </button>
        <div class="fullscreen-time" id="fullscreenTimeDisplay">--:--:-- --</div>
        <div class="fullscreen-date" id="fullscreenDateDisplay">Day, Month DD, YYYY</div>
    </div>

    <audio id="timerSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" preload="auto"></audio>

    <script>
        // DOM Elements
        const modeToggle = document.getElementById('modeToggle');
        const locationTime = document.getElementById('locationTime');
        const timeDisplay = document.getElementById('timeDisplay');
        const dateDisplay = document.getElementById('dateDisplay');
        const manualTimezone = document.getElementById('manualTimezone');
        const timezoneInput = document.getElementById('timezoneInput');
        const setTimezoneBtn = document.getElementById('setTimezoneBtn');
        
        // Tab elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Stopwatch elements
        const stopwatchDisplay = document.getElementById('stopwatchDisplay');
        const startStopwatchBtn = document.getElementById('startStopwatch');
        const stopStopwatchBtn = document.getElementById('stopStopwatch');
        const resetStopwatchBtn = document.getElementById('resetStopwatch');
        const lapStopwatchBtn = document.getElementById('lapStopwatch');
        const stopwatchLaps = document.getElementById('stopwatchLaps');
        
        // Countdown elements
        const countdownDisplay = document.getElementById('countdownDisplay');
        const countdownInput = document.getElementById('countdownInput');
        const startCountdownBtn = document.getElementById('startCountdown');
        const pauseCountdownBtn = document.getElementById('pauseCountdown');
        const resetCountdownBtn = document.getElementById('resetCountdown');
        
        // Pomodoro elements
        const pomodoroDisplay = document.getElementById('pomodoroDisplay');
        const pomodoroCycles = document.getElementById('pomodoroCycles');
        const startPomodoroBtn = document.getElementById('startPomodoro');
        const pausePomodoroBtn = document.getElementById('pausePomodoro');
        const skipPomodoroBtn = document.getElementById('skipPomodoro');
        
        // World Clock elements
        const worldClockContainer = document.getElementById('worldClockContainer');
        
        // Reminders elements
        const reminderInput = document.getElementById('reminderInput');
        const reminderTime = document.getElementById('reminderTime');
        const addReminderBtn = document.getElementById('addReminder');
        const reminderList = document.getElementById('reminderList');
        
        // Fullscreen elements
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const fullscreenClock = document.getElementById('fullscreenClock');
        const closeFullscreen = document.getElementById('closeFullscreen');
        const fullscreenTimeDisplay = document.getElementById('fullscreenTimeDisplay');
        const fullscreenDateDisplay = document.getElementById('fullscreenDateDisplay');
        
        // Audio element
        const timerSound = document.getElementById('timerSound');
        
        // Global variables
        let currentTab = 'stopwatch';
        let darkMode = false;
        let manualTimezoneOffset = 0;
        let isOnline = navigator.onLine;
        
        // Stopwatch variables
        let stopwatchInterval;
        let stopwatchStartTime;
        let stopwatchElapsedTime = 0;
        let stopwatchRunning = false;
        let laps = [];
        
        // Countdown variables
        let countdownInterval;
        let countdownTimeLeft = 0;
        let countdownRunning = false;
        let countdownPaused = false;
        
        // Pomodoro variables
        let pomodoroInterval;
        let pomodoroTimeLeft = 25 * 60; // 25 minutes in seconds
        let pomodoroRunning = false;
        let pomodoroPaused = false;
        let pomodoroPhase = 'work'; // 'work' or 'break'
        let completedPomodoros = 0;
        
        // Reminders variables
        let reminders = [];
        
        // Initialize the app
        function init() {
            // Check if dark mode should be enabled based on time
            checkDarkMode();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize current time display
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Initialize world clock
            initWorldClock();
            
            // Load reminders from localStorage
            loadReminders();
            
            // Check internet connection
            checkInternetConnection();
            
            // Set up offline detection
            window.addEventListener('online', checkInternetConnection);
            window.addEventListener('offline', checkInternetConnection);
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Dark mode toggle
            modeToggle.addEventListener('click', toggleDarkMode);
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            // Stopwatch controls
            startStopwatchBtn.addEventListener('click', startStopwatch);
            stopStopwatchBtn.addEventListener('click', stopStopwatch);
            resetStopwatchBtn.addEventListener('click', resetStopwatch);
            lapStopwatchBtn.addEventListener('click', addLap);
            
            // Countdown controls
            startCountdownBtn.addEventListener('click', startCountdown);
            pauseCountdownBtn.addEventListener('click', pauseCountdown);
            resetCountdownBtn.addEventListener('click', resetCountdown);
            
            // Pomodoro controls
            startPomodoroBtn.addEventListener('click', startPomodoro);
            pausePomodoroBtn.addEventListener('click', pausePomodoro);
            skipPomodoroBtn.addEventListener('click', skipPomodoro);
            
            // Manual timezone
            setTimezoneBtn.addEventListener('click', setManualTimezone);
            
            // Reminders
            addReminderBtn.addEventListener('click', addReminder);
            
            // Fullscreen
            fullscreenBtn.addEventListener('click', openFullscreenClock);
            closeFullscreen.addEventListener('click', closeFullscreenClock);
        }
        
        // Check and set dark mode based on time
        function checkDarkMode() {
            const hours = new Date().getHours();
            // Enable dark mode between 6 PM and 6 AM
            if (hours >= 18 || hours < 6) {
                enableDarkMode();
            } else {
                disableDarkMode();
            }
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            if (darkMode) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        }
        
        // Enable dark mode
        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            modeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            darkMode = true;
        }
        
        // Disable dark mode
        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            modeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            darkMode = false;
        }
        
        // Switch between tabs
        function switchTab(tabId) {
            // Update active tab
            tabs.forEach(tab => {
                if (tab.dataset.tab === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Update active content
            tabContents.forEach(content => {
                if (content.id === tabId) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            currentTab = tabId;
            
            // Special initialization for certain tabs
            if (tabId === 'pomodoro') {
                initPomodoroCycles();
            }
        }
        
        // Update current time display
        function updateCurrentTime() {
            const now = new Date();
            
            // Update time display
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: true 
            };
            const timeString = now.toLocaleTimeString(undefined, timeOptions);
            timeDisplay.textContent = timeString;
            fullscreenTimeDisplay.textContent = timeString;
            
            // Update date display
            const dateOptions = { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric', 
                year: 'numeric' 
            };
            const dateString = now.toLocaleDateString(undefined, dateOptions);
            dateDisplay.textContent = dateString;
            fullscreenDateDisplay.textContent = dateString;
            
            // Check reminders
            checkReminders(now);
        }
        
        // Get user location
        function getUserLocation() {
            if (!isOnline) {
                locationTime.textContent = "Internet connection not available";
                manualTimezone.classList.add('show');
                return;
            }
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async position => {
                        try {
                            const { latitude, longitude } = position.coords;
                            const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
                            const data = await response.json();
                            
                            const city = data.city || data.locality || "your location";
                            const country = data.countryName || "";
                            locationTime.textContent = `${city}${country ? ', ' + country : ''}`;
                        } catch (error) {
                            console.error("Error fetching location:", error);
                            locationTime.textContent = "Your current location";
                        }
                    },
                    error => {
                        console.error("Geolocation error:", error);
                        locationTime.textContent = "Your current location";
                    }
                );
            } else {
                locationTime.textContent = "Your current location";
            }
        }
        
        // Set manual timezone
        function setManualTimezone() {
            const input = timezoneInput.value.trim();
            const gmtRegex = /^GMT([+-]\d{1,2})$/i;
            
            if (gmtRegex.test(input)) {
                const offset = parseInt(input.match(gmtRegex)[1]);
                manualTimezoneOffset = offset * 60 * 60 * 1000; // Convert to milliseconds
                locationTime.textContent = `Manual timezone: ${input}`;
                manualTimezone.classList.remove('show');
            } else {
                alert("Please enter a valid GMT offset (e.g., GMT+6)");
            }
        }
        
        // Check internet connection
        function checkInternetConnection() {
            isOnline = navigator.onLine;
            
            if (isOnline) {
                getUserLocation();
                manualTimezone.classList.remove('show');
            } else {
                locationTime.textContent = "Internet connection not available";
                manualTimezone.classList.add('show');
            }
        }
        
        // Stopwatch functions
        function startStopwatch() {
            if (!stopwatchRunning) {
                stopwatchStartTime = Date.now() - stopwatchElapsedTime;
                stopwatchInterval = setInterval(updateStopwatch, 10);
                stopwatchRunning = true;
                
                startStopwatchBtn.disabled = true;
                stopStopwatchBtn.disabled = false;
                resetStopwatchBtn.disabled = false;
                lapStopwatchBtn.disabled = false;
                
                startStopwatchBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
            }
        }
        
        function stopStopwatch() {
            if (stopwatchRunning) {
                clearInterval(stopwatchInterval);
                stopwatchElapsedTime = Date.now() - stopwatchStartTime;
                stopwatchRunning = false;
                
                startStopwatchBtn.disabled = false;
                stopStopwatchBtn.disabled = true;
            }
        }
        
        function resetStopwatch() {
            clearInterval(stopwatchInterval);
            stopwatchRunning = false;
            stopwatchElapsedTime = 0;
            stopwatchDisplay.textContent = "00:00:00.000";
            laps = [];
            stopwatchLaps.innerHTML = "";
            
            startStopwatchBtn.disabled = false;
            stopStopwatchBtn.disabled = true;
            resetStopwatchBtn.disabled = true;
            lapStopwatchBtn.disabled = true;
            
            startStopwatchBtn.innerHTML = '<i class="fas fa-play"></i> Start';
        }
        
        function updateStopwatch() {
            const elapsed = Date.now() - stopwatchStartTime;
            stopwatchDisplay.textContent = formatTime(elapsed, true);
        }
        
        function addLap() {
            if (stopwatchRunning) {
                const lapTime = Date.now() - stopwatchStartTime;
                const lapNumber = laps.length + 1;
                laps.push(lapTime);
                
                const lapItem = document.createElement('div');
                lapItem.className = 'lap-item';
                lapItem.innerHTML = `
                    <span>Lap ${lapNumber}</span>
                    <span>${formatTime(lapTime, true)}</span>
                `;
                
                stopwatchLaps.prepend(lapItem);
            }
        }
        
        // Countdown functions
        function startCountdown() {
            if (!countdownRunning) {
                // Parse input time
                const timeParts = countdownInput.value.split(':');
                let hours = 0, minutes = 0, seconds = 0;
                
                if (timeParts.length === 3) {
                    hours = parseInt(timeParts[0]) || 0;
                    minutes = parseInt(timeParts[1]) || 0;
                    seconds = parseInt(timeParts[2]) || 0;
                } else if (timeParts.length === 2) {
                    minutes = parseInt(timeParts[0]) || 0;
                    seconds = parseInt(timeParts[1]) || 0;
                } else if (timeParts.length === 1) {
                    seconds = parseInt(timeParts[0]) || 0;
                }
                
                countdownTimeLeft = (hours * 3600) + (minutes * 60) + seconds;
                
                if (countdownTimeLeft <= 0) {
                    alert("Please enter a valid time duration");
                    return;
                }
                
                updateCountdownDisplay();
                
                countdownInterval = setInterval(() => {
                    if (countdownTimeLeft > 0) {
                        countdownTimeLeft--;
                        updateCountdownDisplay();
                    } else {
                        countdownFinished();
                    }
                }, 1000);
                
                countdownRunning = true;
                countdownPaused = false;
                
                startCountdownBtn.disabled = true;
                pauseCountdownBtn.disabled = false;
                resetCountdownBtn.disabled = false;
            }
        }
        
        function pauseCountdown() {
            if (countdownRunning && !countdownPaused) {
                clearInterval(countdownInterval);
                countdownPaused = true;
                pauseCountdownBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
            } else if (countdownPaused) {
                countdownInterval = setInterval(() => {
                    if (countdownTimeLeft > 0) {
                        countdownTimeLeft--;
                        updateCountdownDisplay();
                    } else {
                        countdownFinished();
                    }
                }, 1000);
                countdownPaused = false;
                pauseCountdownBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            }
        }
        
        function resetCountdown() {
            clearInterval(countdownInterval);
            countdownRunning = false;
            countdownPaused = false;
            countdownTimeLeft = 0;
            countdownDisplay.textContent = "00:00:00";
            
            startCountdownBtn.disabled = false;
            pauseCountdownBtn.disabled = true;
            resetCountdownBtn.disabled = true;
            
            pauseCountdownBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
        }
        
        function updateCountdownDisplay() {
            countdownDisplay.textContent = formatTime(countdownTimeLeft * 1000);
        }
        
        function countdownFinished() {
            clearInterval(countdownInterval);
            countdownRunning = false;
            playTimerSound();
            alert("Countdown finished!");
            resetCountdown();
        }
        
        // Pomodoro functions
        function initPomodoroCycles() {
            pomodoroCycles.innerHTML = '';
            for (let i = 0; i < 4; i++) {
                const cycle = document.createElement('div');
                cycle.className = 'cycle';
                if (i < completedPomodoros) {
                    cycle.classList.add('completed');
                }
                pomodoroCycles.appendChild(cycle);
            }
        }
        
        function startPomodoro() {
            if (!pomodoroRunning) {
                if (pomodoroPhase === 'work') {
                    pomodoroTimeLeft = 25 * 60; // 25 minutes
                    startPomodoroBtn.innerHTML = '<i class="fas fa-play"></i> Start Work';
                } else {
                    pomodoroTimeLeft = 5 * 60; // 5 minutes
                    startPomodoroBtn.innerHTML = '<i class="fas fa-play"></i> Start Break';
                }
                
                updatePomodoroDisplay();
                
                pomodoroInterval = setInterval(() => {
                    if (pomodoroTimeLeft > 0) {
                        pomodoroTimeLeft--;
                        updatePomodoroDisplay();
                    } else {
                        pomodoroFinished();
                    }
                }, 1000);
                
                pomodoroRunning = true;
                pomodoroPaused = false;
                
                startPomodoroBtn.disabled = true;
                pausePomodoroBtn.disabled = false;
                skipPomodoroBtn.disabled = false;
            }
        }
        
        function pausePomodoro() {
            if (pomodoroRunning && !pomodoroPaused) {
                clearInterval(pomodoroInterval);
                pomodoroPaused = true;
                pausePomodoroBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
            } else if (pomodoroPaused) {
                pomodoroInterval = setInterval(() => {
                    if (pomodoroTimeLeft > 0) {
                        pomodoroTimeLeft--;
                        updatePomodoroDisplay();
                    } else {
                        pomodoroFinished();
                    }
                }, 1000);
                pomodoroPaused = false;
                pausePomodoroBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            }
        }
        
        function skipPomodoro() {
            clearInterval(pomodoroInterval);
            pomodoroFinished();
        }
        
        function updatePomodoroDisplay() {
            const minutes = Math.floor(pomodoroTimeLeft / 60);
            const seconds = pomodoroTimeLeft % 60;
            pomodoroDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function pomodoroFinished() {
            clearInterval(pomodoroInterval);
            pomodoroRunning = false;
            playTimerSound();
            
            if (pomodoroPhase === 'work') {
                completedPomodoros++;
                if (completedPomodoros >= 4) {
                    completedPomodoros = 0;
                    alert("Great job! You've completed 4 work sessions. Take a longer break!");
                } else {
                    alert("Work session complete! Take a 5-minute break.");
                }
                pomodoroPhase = 'break';
                startPomodoroBtn.innerHTML = '<i class="fas fa-play"></i> Start Break';
            } else {
                alert("Break time over! Ready for another work session?");
                pomodoroPhase = 'work';
                startPomodoroBtn.innerHTML = '<i class="fas fa-play"></i> Start Work';
            }
            
            initPomodoroCycles();
            updatePomodoroDisplay();
            
            startPomodoroBtn.disabled = false;
            pausePomodoroBtn.disabled = true;
            skipPomodoroBtn.disabled = true;
            
            pausePomodoroBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
        }
        
        // World Clock functions
        function initWorldClock() {
            const cities = [
                { name: "New York", timezone: "America/New_York" },
                { name: "London", timezone: "Europe/London" },
                { name: "Mecca", timezone: "Asia/Riyadh" }, // Mecca uses Riyadh timezone
                { name: "Tokyo", timezone: "Asia/Tokyo" },
                { name: "Dhaka", timezone: "Asia/Dhaka" }
            ];
            
            worldClockContainer.innerHTML = '';
            
            cities.forEach(city => {
                const cityElement = document.createElement('div');
                cityElement.className = 'clock-city';
                cityElement.innerHTML = `
                    <div class="clock-city-name">${city.name}</div>
                    <div class="clock-city-time" id="${city.name.replace(/\s+/g, '')}Time">--:--:-- --</div>
                `;
                worldClockContainer.appendChild(cityElement);
            });
            
            // Update world clock every second
            setInterval(updateWorldClock, 1000);
            updateWorldClock();
        }
        
        function updateWorldClock() {
            const cities = [
                { name: "New York", timezone: "America/New_York" },
                { name: "London", timezone: "Europe/London" },
                { name: "Mecca", timezone: "Asia/Riyadh" },
                { name: "Tokyo", timezone: "Asia/Tokyo" },
                { name: "Dhaka", timezone: "Asia/Dhaka" }
            ];
            
            cities.forEach(city => {
                const options = {
                    timeZone: city.timezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true
                };
                
                try {
                    const timeString = new Date().toLocaleTimeString('en-US', options);
                    document.getElementById(`${city.name.replace(/\s+/g, '')}Time`).textContent = timeString;
                } catch (e) {
                    console.error(`Error updating time for ${city.name}:`, e);
                }
            });
        }
        
        // Reminders functions
        function loadReminders() {
            const savedReminders = localStorage.getItem('reminders');
            if (savedReminders) {
                reminders = JSON.parse(savedReminders);
                renderReminders();
            }
        }
        
        function saveReminders() {
            localStorage.setItem('reminders', JSON.stringify(reminders));
        }
        
        function addReminder() {
            const text = reminderInput.value.trim();
            const time = reminderTime.value;
            
            if (!text || !time) {
                alert("Please enter both reminder text and time");
                return;
            }
            
            const [hours, minutes] = time.split(':').map(Number);
            const now = new Date();
            const reminderDate = new Date(
                now.getFullYear(),
                now.getMonth(),
                now.getDate(),
                hours,
                minutes
            );
            
            // If the time has already passed today, set it for tomorrow
            if (reminderDate < now) {
                reminderDate.setDate(reminderDate.getDate() + 1);
            }
            
            const reminder = {
                id: Date.now(),
                text,
                time: reminderDate.getTime(),
                timeString: time
            };
            
            reminders.push(reminder);
            saveReminders();
            renderReminders();
            
            // Clear inputs
            reminderInput.value = '';
            reminderTime.value = '';
        }
        
        function renderReminders() {
            reminderList.innerHTML = '';
            
            if (reminders.length === 0) {
                reminderList.innerHTML = '<p>No reminders set yet.</p>';
                return;
            }
            
            // Sort reminders by time
            reminders.sort((a, b) => a.time - b.time);
            
            reminders.forEach(reminder => {
                const reminderItem = document.createElement('div');
                reminderItem.className = 'reminder-item';
                reminderItem.innerHTML = `
                    <span>${reminder.text} at ${reminder.timeString}</span>
                    <button data-id="${reminder.id}"><i class="fas fa-trash"></i></button>
                `;
                
                reminderItem.querySelector('button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteReminder(reminder.id);
                });
                
                reminderList.appendChild(reminderItem);
            });
        }
        
        function deleteReminder(id) {
            reminders = reminders.filter(reminder => reminder.id !== id);
            saveReminders();
            renderReminders();
        }
        
        function checkReminders(now) {
            const currentTime = now.getTime();
            const currentHours = now.getHours();
            const currentMinutes = now.getMinutes();
            
            reminders.forEach(reminder => {
                const reminderDate = new Date(reminder.time);
                const reminderHours = reminderDate.getHours();
                const reminderMinutes = reminderDate.getMinutes();
                
                // Check if current time matches reminder time (within 1 minute)
                if (currentHours === reminderHours && 
                    currentMinutes === reminderMinutes &&
                    !reminder.notified) {
                    
                    alert(`Reminder: ${reminder.text}`);
                    reminder.notified = true;
                    saveReminders();
                    
                    // Reset notified flag after 1 minute to allow repeat next day
                    setTimeout(() => {
                        const updatedReminder = reminders.find(r => r.id === reminder.id);
                        if (updatedReminder) {
                            updatedReminder.notified = false;
                            saveReminders();
                        }
                    }, 60000);
                }
            });
        }
        
        // Fullscreen clock functions
        function openFullscreenClock() {
            fullscreenClock.classList.add('active');
            updateCurrentTime();
        }
        
        function closeFullscreenClock() {
            fullscreenClock.classList.remove('active');
        }
        
        // Helper functions
        function formatTime(milliseconds, showMilliseconds = false) {
            let totalSeconds = Math.floor(milliseconds / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            totalSeconds %= 3600;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            
            if (showMilliseconds) {
                const ms = Math.floor((milliseconds % 1000) / 10);
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${ms.toString().padStart(2, '0')}`;
            } else {
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        function playTimerSound() {
            timerSound.currentTime = 0;
            timerSound.play().catch(e => console.error("Error playing sound:", e));
        }
        
        // Initialize the app
        init();
    </script>
</body>
</html>
